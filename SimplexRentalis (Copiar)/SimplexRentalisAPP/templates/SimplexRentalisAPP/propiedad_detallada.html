{% extends 'base.html' %}
{% load static %}
{% block title %}
Propiedad en detalle
{% endblock %}

{% block content %}
<!-- Enlace al archivo CSS -->
<!--<link rel="stylesheet" type="text/css" href="{% static 'path/to/style.css' %}">-->

<div id="main-content">
    <h1 class="propiedad-title">{{ propiedad.titulo }}</h1>
    
    <div class="detalle-container">
        <!-- Sección de la Imagen Principal -->
        <div class="propiedad-image">
            {% if imagen_portada %}
                <img src="{{ imagen_portada.imagen.url }}" alt="Imagen de Portada" class="img-fluid main-image" id="main-image" onclick="changeImage('{{ imagen_portada.imagen.url }}', this)">
            {% else %}
                <div class="no-imagen">
                    No hay imagen de portada disponible.
                </div>
            {% endif %}
            
            <!-- Contenedor de las miniaturas -->
            <div class="thumbnails-container">
                <div class="thumbnail-wrapper" id="thumbnails-wrapper">
                    {% for imagen in propiedad.imagenes_set.all %}
                        <img src="{{ imagen.imagen.url }}" alt="Vista previa de {{ propiedad.titulo }}" class="thumbnail-image" onclick="changeImage('{{ imagen.imagen.url }}', this)">
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Sección de Información -->
        <div class="propiedad-details">
            <p><strong>Dueño:</strong> {{ propiedad.usuario }}</p>
            <p><strong>Dirección:</strong> {{ propiedad.direccion }}</p>
            <p><strong>Descripción:</strong> {{ propiedad.descripcion }}</p>
            <p><strong>Precio:</strong> {{ propiedad.precio }} €</p>
            <p><strong>Calificación:</strong> {{ propiedad.calificacion }}</p>
        </div>
    </div>

    <!-- Descripción Debajo de la Imagen -->
    <div class="descripcion-container">
        <h3>Descripción</h3>
        <p>{{ propiedad.descripcion }}</p>
    </div>

    <!-- Sección de Opiniones -->
    <div class="opiniones-container">
        <h3>Opiniones</h3>
        {% for opinion in propiedad.opiniones_set.all %}
            <div class="opinion">
                <strong>{{ opinion.usuario }}:</strong>
                <p>{{ opinion.texto }}</p>
            </div>
        {% empty %}
            <p>No hay opiniones disponibles.</p>
        {% endfor %}
    </div>

    <div class="back-link">
        <a href="{% url 'propiedades' %}" class="btn">Volver a la lista de propiedades</a>
    </div>
</div>

<script>
    function changeImage(imageUrl, thumbnailElement) {
        // Cambia la imagen principal
        const mainImage = document.getElementById('main-image');
        mainImage.src = imageUrl;

        // Añade clase activa a la miniatura seleccionada
        const thumbnails = document.querySelectorAll('.thumbnail-image');
        thumbnails.forEach(thumb => thumb.classList.remove('active')); // Elimina la clase activa de todas las miniaturas
        thumbnailElement.classList.add('active'); // Añade la clase activa a la miniatura seleccionada
    }
</script>

{% endblock %}
