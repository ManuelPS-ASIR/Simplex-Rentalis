{% extends 'base.html' %}
{% load static %}
{% block title %}
Propiedad en detalle
{% endblock %}

{% block content %}
<div id="main-content">
    <h1 class="propiedad-title">{{ propiedades.nombre }}</h1>
    
    <div class="detalle-container">
        <!-- Sección de la Imagen Principal -->
        <div class="propiedad-image">
            <div class="image-navigation">
                <!-- Flecha izquierda -->
                <span class="arrow left-arrow" onclick="changeImageByArrow('prev')">
                    <img src="{% static 'defaults/flecha-izquierda.png' %}" alt="Flecha Izquierda">
                </span>
            </div>
            
            {% if imagen_portada %}
                <img src="{{ imagen_portada.imagen.url }}" alt="Imagen de Portada" class="img-fluid main-image" id="main-image" onclick="changeImage('{{ imagen_portada.imagen.url }}', this)">
            {% else %}
                <div class="no-imagen">
                    No hay imagen de portada disponible.
                </div>
            {% endif %}
            
            <!-- Contenedor de las miniaturas -->
            <div class="thumbnails-container">
                <div class="thumbnail-wrapper" id="thumbnails-wrapper">
                    {% for imagen in imagenes %}
                        <img src="{{ imagen.imagen.url }}" alt="{{ imagen.descripcion }}" class="thumbnail-image" onclick="changeImage('{{ imagen.imagen.url }}', this)">
                    {% endfor %}
                </div>
            </div>

            <div class="image-navigation">
                <!-- Flecha derecha -->
                <span class="arrow right-arrow" onclick="changeImageByArrow('next')">
                    <img src="{% static 'defaults/flecha-derecha.png' %}" alt="Flecha Derecha">
                </span>
            </div>
        </div>
        
        <!-- Sección de Información -->
        <div class="propiedad-details">
            <p><strong>Dueño:</strong> {{ propiedades.propietario.username }}</p> <!-- Mostrar el nombre del propietario -->
            <p><strong>Dirección:</strong> {{ propiedades.direccion }}</p>
            <p><strong>Precio por noche:</strong> {{ propiedades.precio_noche }} €</p>
            <p><strong>Calificación:</strong> {{ propiedades.calificacion }}</p>
            <p><strong>Permite mascotas:</strong> {{ propiedades.permite_mascotas|yesno:"Sí,No" }}</p>
            <p><strong>Capacidad máxima:</strong> {{ propiedades.capacidad_maxima }} personas</p>
        </div>
    </div>

    <!-- Descripción Debajo de la Imagen -->
    <div class="descripcion-container">
        <h3>Descripción</h3>
        <p>{{ propiedades.descripcion }}</p>
    </div>

    <!-- Sección de Opiniones -->
    <div class="opiniones-container">
        <h3>Opiniones</h3>
        {% for opinion in propiedades.opiniones_set.all %}
            <div class="opinion">
                <strong>{{ opinion.usuario }}:</strong>
                <p>{{ opinion.texto }}</p>
            </div>
        {% empty %}
            <p>No hay opiniones disponibles.</p>
        {% endfor %}
    </div>

    <div class="back-link">
        <a href="{% url 'propiedades' %}" class="btn">Volver a la lista de propiedades</a>
    </div>
</div>

<script>
    let currentImageIndex = 0; // Índice de la imagen actual

    // Cambia la imagen principal
    function changeImage(imageUrl, thumbnailElement) {
        const mainImage = document.getElementById('main-image');
        mainImage.src = imageUrl;

        // Actualizar el índice de la imagen principal
        const thumbnails = document.querySelectorAll('.thumbnail-image');
        thumbnails.forEach(thumb => thumb.classList.remove('active')); // Elimina la clase activa de todas las miniaturas
        thumbnailElement.classList.add('active'); // Añade la clase activa a la miniatura seleccionada
    }

    // Cambiar imagen con las flechas
    function changeImageByArrow(direction) {
        const images = document.querySelectorAll('.thumbnail-image');
        if (direction === 'next') {
            currentImageIndex = (currentImageIndex + 1) % images.length; // Ir a la siguiente imagen
        } else if (direction === 'prev') {
            currentImageIndex = (currentImageIndex - 1 + images.length) % images.length; // Ir a la imagen anterior
        }
        const newImage = images[currentImageIndex];
        changeImage(newImage.src, newImage); // Cambia la imagen principal al hacer clic en las flechas
    }
</script>
{% endblock %}
